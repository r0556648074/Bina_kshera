### מסמך איפיון מקיף – "נגן בינה כשרה"

> **גרסה:** 0.1  **תאריך:** 1 ביוני 2025  **מחבר:** ChatGPT

---

## 1  חזון ומטרה

* לספק נגן אודיו/ווידאו‑שמע שמאפשר "ראיית הקולות" – שילוב מדויק בין צליל, טקסט וויזואליזציה – בממשק אחד נקי, מאובטח, וכשר‑למהדרין (אופליין מוחלט כברירת‑מחדל).
* להוריד חסם גישה ללמידה, הוראה ותחקור מולטימדיה במגזר הדתי־חרדי, מבלי לוותר על טכנולוגיות AI עדכניות.

## 2  קהל יעד

1. לומדי תורה, אברכים ומרצים.
2. מוסדות חינוך (כולל כיתות מחשבים "מסוננות").
3. עורכי‑שמע, פודקאסטרים כשרים.
4. משתמשי בית המעוניינים בחיפוש מהיר בשיעורים מוקלטים.

## 3  תרחישי שימוש (Use Cases)

* **האזנה ממוקדת:** חיפוש ביטוי בגמרא, קפיצה לטיים‑קוד ושמיעה מיידית.
* **הכנת שיעור:** סימון קטעים, הוספת סימניות, ייצוא קליפ + תמלול.
* **התמצאות במאות שיעורים:** טעינת ספרייה, חיפוש מילולי וקונספטואלי.
* **פידבק למרצה חרדי:** צפייה באנרגיה וקצב דיבור (“רואים את הקולות”).

## 4  דרישות פונקציונליות

### 4.1 ניגון שמע

* תמיכת פורמטים : WAV, MP3, FLAC, Opus (מובנה).
* שליטה ב‑Play/Pause, Seek, Loop, Speed 0.25–3×.
* מצב “תצוגה קטנה” (PiP) – חלון Always‑on‑Top.

### 4.2 הצגה ויזואלית – “רואים את הקולות”

* Waveform דינמי + Playhead.
* Spectrogram חי (FFT 2048, 0‑10 kHz, סקאלת dB צבעונית).
* צביעת דוברים (Speaker Diarization) – פס צבע לכל דובר במסילה צדדית.
* הדגשת מילה בזמן אמת (קריוקי) ±50 ms.

### 4.3 תמלול מסונכרן

* טעינת תמלול מהמיכל (.bc1), ברמת‑מילה.
* Auto‑Scroll לשורה פעילה; אפשרות Free‑Scroll.
* תצוגת Dual‑Script (עברית‑אנגלית) בשכבת Split.

### 4.4 חיפוש

* **FTS מילולי** (Wildcards, הטיות בעברית).
* **חיפוש קונספטואלי** – Embeddings SBERT + FAISS.
* חיווי Pins על ה‑Waveform; מעבר עם חיצים בין תוצאות.

### 4.5 ניהול קליפים וסימניות

* Bookmark ב‑Hotkey (Ctrl+B) עם תיאור.
* Cut Clip → ייצוא MP3/MP4 + SRT / TXT.
* Playlist builder לתיקיות.

### 4.6 נגישות וכשרות

* מצב High‑Contrast, הגדלת פונטים עד 200 %.
* אופליין מוחלט; אין קריאות־רשת כברירת‑מחדל.
* מנגנון Lock‑Mode (חסימת URL חיצוניים) לאולמות שיעורים.

## 5  דרישות לא‑פונקציונליות

| תחום        | יעד                                                   |
| ----------- | ----------------------------------------------------- |
| **ביצועים** | זמן טעינה < 1 s, חיפוש < 70 ms עד 100 k סגמנטים       |
| **זיכרון**  | ‎< 150 MB בקובץ שעה (48 kHz Stereo)                   |
| **אבטחה**   | AES‑256‑GCM לכל קובץ ב‑.bc1; חתימה SHA‑256 על המניפסט |
| **תחזוקה**  | קוד מודולרי, כיסוי בדיקות ≥ 90 % Unit                 |
| **תאימות**  | Windows 10 ×64 ומעלה; ללא התקנת Codec חיצוני          |

## 6  ארכיטקטורה

* **Parser (.bc1)** – אחראי על קריאה/כתיבה, בדיקת גרסה וצ’קסום.
* **Audio Engine** – FFmpeg סטטי → WASAPI; Pipe ל‑Qt AudioSink.
* **Index Engine** – SQLite FTS5 בזיכרון + אופציונלי Qdrant local.
* **AI bridge** – ONNXRuntime CPU (ל‑RAG בזמן שאלה, אופציונלי).
* **UI /QML** – Waveform, Transcript, SearchOverlay, Settings.
* **Controllers** – PlaybackCtrl, HighlightCtrl, SearchCtrl.

## 7  פורמט .bc1 (תקציר)

```
.bc1 (ZIP)
├─ manifest.json                # גרסה, checksums, flags
├─ audio/audio.opus             # קובץ אודיו אחד
└─ data/
   ├─ transcript.jsonl.gz       # תמלול דחוס
   ├─ metadata.json             # אופציונלי
   └─ bookmarks.json            # אופציונלי
```

* כל קובץ מוצפן AES‑GCM (אם FLAGS → "encrypt": true).

## 8  תרשים זרימה מרכזי (טעינה)

1. המשתמש גורר ‎lesson.bc1.
2. ‎Parser בודק מניפסט, מפענח, גוזר BytesIO.
3. AudioEngine מתחיל Decode → RingBuffer.
4. IndexEngine טוען תמלול; HighlightCtrl מאזין ל‑Tick.
5. UI מקבל Frames (Signal) ומצייר Waveform + הדגשה.

## 9  עיצוב ממשק (UX)

* **Dark Material**; טורקיז #4CAF50 כצבע Accent.
* חלוקה אנכית – Waveform 160 px, Transcript fill.
* כפתורי עיגול 48 px עם Ripple.
* אנימציית Fade‑in להדגשת מילים (150 ms).
* קיצורי מקשים: Space ▶/⏸, Ctrl+F חיפוש, J/L ←/→ 5 s, Shift+←/→ 30 s.

## 10  התקנה ועדכונים

* ‎PyInstaller → ‎holyplayer.exe יחיד.
* מתקין Inno Setup חתום; רושם סיומת .bc1 ואייקון.
* Auto‑Updater בודק GitHub Releases, מוריד Patch דלתא חתום.

## 11  ציות לכשרות דיגיטלית

* “מצב סגור” – קוד החשש: מצפין קבצי bc1 ומאפשר שימוש אופליין בלבד.
* חותמת Digital Certificate מעמותה מוכרת.
* קוד מקור חסום פרוקסי‑URL כדי למנוע Playback מקישורי HTTP.

## 12  תכנית בדיקות (QA)

* **Audio Stress** – קובץ 4 ש’@96 kHz, Seamless seek.
* **Search Load** – 1 מ’ סגמנטים, ≤ 150 ms לחיפוש.
* **Diarization Accuracy** – Δ < 200 ms בין תיוג לדובר־אמת.
* **Installer Smoke** – VM נקי Win10; מפעיל ללא DLL חיצוניים.

## 13   Roadmap פיצ’רים עתידיים

* **Voice Commands** – “חפש לי ‘הלכה’ ” ללא רשת.
* **WebAssembly Port** – הפעלת הנגן בדפדפן סגור.
* **Multi‑angle** – סנכרון וידאו ב‑PiP יחד עם האודיו.

---

> **סטטוס המסמך:** טיוטת‑על לאישור ראשוני.
> עם האישור נפרט Wireframes, API פנימיים ו‑DB Schema מלא.
